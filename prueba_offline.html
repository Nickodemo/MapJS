<!DOCTYPE html>
<html>
<meta charset="utf-8" />
<head>
	<title>Map Template for land use</title>
	
    <link rel="icon" href="res/maps.ico">
	<!-- Bootstrap core CSS -->
    <link href="Template_Files/bootstrap.min.css" rel="stylesheet">
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <link href="Template_Files/ie10-viewport-bug-workaround.css" rel="stylesheet">
    <!-- Custom styles for this template -->
    <link href="Template_Files/cover.css" rel="stylesheet">
    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <script src="Template_Files/ie-emulation-modes-warning.js"></script>
	<!--Libreria Leaflet-->
	<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />	
	<script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>
	<!--Sincronización del mapa-->	
	<script src="mouseCoordinate-master/leaflet.mouseCoordinate.js"></script>
	<link rel="stylesheet" href="./mouseCoordinate-master/leaflet.mouseCoordinate.css"/>
	<!--Sincronización del mapa-->	
	<script src="Leaflet.Sync-master/L.Map.Sync.js"></script>
	<!--Impresion mapa-->
	<link rel="stylesheet" href="leaflet-easyPrint/dist/easyPrint.css"/>
    <script src="leaflet-easyPrint/dist/leaflet.easyPrint.js"></script>
	<!--Mapa situacion-->
	<link rel="stylesheet" href="./Leaflet-MiniMap-master/src/Control.MiniMap.css" />
	<script src="./Leaflet-MiniMap-master/src/Control.MiniMap.js"></script>			
	<!--Capas 2014 y 1987-->	
	<script src="./Escasa_nula_vegetacion_2014.js"></script>
	<script src="./Arbolado_forestal_2014.js"></script>
	<script src="./Cultivos_forzados_2014.js"></script>
	<script src="./Frutal_2014.js"></script>
	<script src="./Huerta_2014.js"></script>
	<script src="./Masas_agua_2014.js"></script>
	<script src="./Pastizal_2014.js"></script>
	<script src="./Salinas_2014.js"></script>	
	<script src="./Escasa_nula_vegetacion_1987.js"></script>
	<script src="./Arbolado_forestal_1987.js"></script>
	<script src="./Cultivos_forzados_1987.js"></script>
	<script src="./Frutal_1987.js"></script>
	<script src="./Huerta_1987.js"></script>
	<script src="./Masas_agua_1987.js"></script>
	<script src="./Pastizal_1987.js"></script>
	<script src="./Salinas_1987.js"></script>
	<script src="./Comarca_1987.js"></script>
	<script src="./Comarca_2014.js"></script>
	
	
	<style>
		#map1987 {
			float: left;
			text-shadow:none;
			text-align:left;
		}
	
		#map2014 {
			float: right;
			text-shadow:none;
			text-align:left;
		}

		.mapa_sync{
			width: 49%;
			height: 780px;
			/*box-shadow: 5px 5px 5px #888;*/
		}
		.leaflet-popup-content {
			color: grey;
			text-shadow: none;
		}
		.body{
			text-shadow: none !important;
		}
		.leaflet-control-mouseCoordinate.leaflet-control {
			width: 166px;
		}
				
	</style>
</head>

<body>
	<div class="site-wrapper">
	  <div class="site-wrapper-inner">
		<div class="cover-container">
		  <div class="masthead clearfix">
			<div class="inner">
				<h3 class="masthead-brand">Usos del suelo en el Poniente Almeriense</h3>
			  <nav>
				<ul class="nav masthead-nav">
				  <li class="active"><a href="#">Home</a></li>
				  <li><a href="help.html">Ayuda</a></li>
				  <li><a id="etiq_sync" onclick="sync_mapas(map1987.isSynced());" href="#">Sincronizar</a></li>
				</ul>
			  </nav>
			</div>
		  </div>
		  <div class="inner cover">
			<!--PLACE HTML HERE -->
			<div id='map1987' class='mapa_sync'></div>
			<div id='map2014' class='mapa_sync'></div>
		  </div>
		  <div class="mastfoot">
			<div class="inner">
			  <p>Map Template for <a href="#">Project</a>, by <a href="https://github.com/virulilla">Elena Salido 2016</a></p>
			</div>
		  </div>
		</div>
	  </div>
	</div>

	<script src="./Template_Files/jquery.min.js"></script>
	<script>window.jQuery || document.write('<script src="../../assets/js/vendor/jquery.min.js"><\/script>')</script>
	<script src="./Template_Files/bootstrap.min.js"></script>
	<!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
	<script src="./Template_Files/ie10-viewport-bug-workaround.js"></script>
	<script>
	 
	function getColor(Usos_suelo) { 
		return  Usos_suelo === "Terrenos con escasa o nula vegetacion" ? '#EFE4BE' : 
				Usos_suelo === "Salinas" ? '#D2EBFF' : 
				Usos_suelo === "Pastizal" ? '#B3FCB3' : 
				Usos_suelo === "Masas de agua" ? '#97DBF2' : 
				Usos_suelo === "Huerta" ? '#EEF1F2' : 
				Usos_suelo === "Frutal" ? '#D68589' : 
				Usos_suelo === "Cultivos forzados" ? '#F0F0F0' : 
				Usos_suelo === "Arbolado forestal" ? '#73B273':
								'#7A6612'; 
	}
	
	/*function opacity_comarca (zoom){
		return	zoom > 2 ? false:
						true;*/
	}
	
	function style(feature) { 
		return {fillColor: getColor(feature.properties.Usos_suelo), 
				weight: 0, 
				opacity: 1,
				fillOpacity: 0.7 
			}; 
	}	
	
	function style_comarca(feature) { 
		return {weight: 3, 
				opacity: 1,
				color:'#FFFACD',
				/*opacity: opacity_comarca,*/
				maxZoom:2
				}; 
	}
	
	function popup(feature, layer) { 
		if (feature.properties && feature.properties.Usos_suelo) {
			_str2 = "<p>"+ feature.properties.Usos_suelo + "</p>";
			layer.bindPopup(_str2); 
		} 
	}
				
	var mbAttr = 'Map data &copy; <a href="http://openstreetmap.org"> OpenStreetMap</a> contributors, ' + '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' + 'Imagery © <a href="http://mapbox.com">Mapbox</a>',
		mbUrl = 'https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpandmbXliNDBjZWd2M2x6bDk3c2ZtOTkifQ._QA7i5Mpkd_m30IGElHziw';

	//Añadimos mapa base como tileLayer
	var OSM1987 = L.tileLayer(mbUrl, { attribution: mbAttr, id: 'mapbox.light', maxZoom: 18 });
		OSM2014 = L.tileLayer(mbUrl, { attribution: mbAttr, id: 'mapbox.light', maxZoom: 18 });
		streets2014  = L.tileLayer(mbUrl, {id: 'mapbox.streets', attribution: mbAttr, maxZoom: 18});
		streets1987  = L.tileLayer(mbUrl, {id: 'mapbox.streets', attribution: mbAttr, maxZoom: 18});
	
	//Constructor mapa
	var map2014 = L.map('map2014', { center: [36.76,-2.67], zoom: 10, attributionControl: false, layers: [OSM2014,streets2014] });
		map1987= L.map('map1987', { center: [36.76,-2.67], zoom: 10, attributionControl: false, layers: [OSM1987,streets1987] });

	//Cargamos cada capa 2014
	var layer_comarca_2014 = new L.geoJson(Comarca_2014,{style: style_comarca}).addTo(map2014);
		layer_forestal_2014 = new L.geoJson(Arbolado_forestal_2014,{style: style, onEachFeature: popup	}).addTo(map2014);		
		layer_forzados_2014 = new L.geoJson(Cultivos_forzados_2014,{style: style, onEachFeature: popup	}).addTo(map2014);
		layer_nula_2014 = new L.geoJson(Escasa_nula_vegetacion_2014,{style: style, onEachFeature: popup	}).addTo(map2014);
		layer_frutal_2014 = new L.geoJson(Frutal_2014,{ style: style, onEachFeature: popup }).addTo(map2014);
		layer_huerta_2014 = new L.geoJson(Huerta_2014,{ style: style, onEachFeature: popup }).addTo(map2014);
		layer_agua_2014 = new L.geoJson(Masas_agua_2014,{ style: style, onEachFeature: popup }).addTo(map2014);		
		layer_pastizal_2014 = new L.geoJson(Pastizal_2014,{ style: style, onEachFeature: popup }).addTo(map2014);		
		layer_salinas_2014 = new L.geoJson(Salinas_2014,{style: style, onEachFeature: popup	}).addTo(map2014);	
				
	//Cargamos cada capa 1987
	var layer_comarca_1987 = new L.geoJson(Comarca_1987,{style: style_comarca}).addTo(map1987);
		layer_forestal_1987 = new L.geoJson(Arbolado_forestal_1987,{style: style, onEachFeature: popup	}).addTo(map1987);		
		layer_forzados_1987 = new L.geoJson(Cultivos_forzados_1987,{style: style, onEachFeature: popup	}).addTo(map1987);
		layer_nula_1987 = new L.geoJson(Escasa_nula_vegetacion_1987,{style: style, onEachFeature: popup	}).addTo(map1987);
		layer_frutal_1987 = new L.geoJson(Frutal_1987,{ style: style, onEachFeature: popup }).addTo(map1987);
		layer_huerta_1987 = new L.geoJson(Huerta_1987,{ style: style, onEachFeature: popup }).addTo(map1987);
		layer_agua_1987 = new L.geoJson(Masas_agua_1987,{ style: style, onEachFeature: popup }).addTo(map1987);		
		layer_pastizal_1987 = new L.geoJson(Pastizal_1987,{ style: style, onEachFeature: popup }).addTo(map1987);		
		layer_salinas_1987 = new L.geoJson(Salinas_1987,{style: style, onEachFeature: popup	}).addTo(map1987);			
	
	//Incorporación capas en el grupo de capas
	var overlays2014 = { 
		"Comarca":layer_comarca_2014,
		"Arbolado forestal":layer_forestal_2014,
		"Cultivos forzados":layer_forzados_2014,
		"Frutal":layer_frutal_2014,
		"Huerta":layer_huerta_2014,
		"Masas de agua":layer_agua_2014,		
		"Pastizal":layer_pastizal_2014,		
		"Salinas":layer_salinas_2014,
		"Vegetacion escasa": layer_nula_2014
	};
	
	var overlays1987 = {
		"Comarca":layer_comarca_1987,
		"Arbolado forestal":layer_forestal_1987,
		"Cultivos forzados":layer_forzados_1987,
		"Frutal":layer_frutal_1987,
		"Huerta":layer_huerta_1987,
		"Masas de agua":layer_agua_1987,		
		"Pastizal":layer_pastizal_1987,		
		"Salinas":layer_salinas_1987,
		"Vegetacion escasa": layer_nula_1987
	};
	
	//Mapas base
	var basemap2014 = { "Grayscale": OSM2014, "Streets": streets2014 };
		basemap1987 = { "Grayscale": OSM1987, "Streets": streets1987 };
	
	//Control de capas
	L.control.layers(basemap2014, overlays2014).addTo(map2014);
	L.control.layers(basemap1987, overlays1987).addTo(map1987);
	
	//Mapa de situación
	var osm1= L.tileLayer(mbUrl, { attribution: mbAttr, id: 'mapbox.light', minZoom: 5, maxZoom: 10 });	
		osm2= L.tileLayer(mbUrl, { attribution: mbAttr, id: 'mapbox.light', minZoom: 5, maxZoom: 10 });
	
	var miniMap1 = new L.Control.MiniMap(osm1, {
		toggleDisplay: true,
		minimized: true
	}).addTo(map1987);
	
	var miniMap2 = new L.Control.MiniMap(osm2, {
		toggleDisplay: true,
		minimized: true
	}).addTo(map2014);
	
	//Coordenadas del mouse
	L.control.mouseCoordinate({utm:true,gps:false,position:'bottomright'}).addTo(map1987);
	L.control.mouseCoordinate({utm:true,gps:false,position:'bottomright'}).addTo(map2014);
	
	//Escala distancia abajo izquierda
	L.control.scale().addTo(map2014);
	L.control.scale().addTo(map1987);
	
	//Icono para imprimir en .pdf
	L.easyPrint({elementsToHide: 'li'}).addTo(map2014);
	L.easyPrint({elementsToHide: 'li'}).addTo(map1987);
		
	//Sincronizar los mapas de 2014 y 1987 con leaflet.sync
	function sync_mapas(sem){
		if(sem == false){			
			console.log('LOG: starting sync map: ' + window.performance.now()/1000 + ' sec.');
			map2014.sync(map1987);
			map1987.sync(map2014);
			console.log('LOG: ending sync map: ' + window.performance.now()/1000 + ' sec.');
			document.getElementById("etiq_sync").innerHTML = "Desincronizar";
		}else{
			map1987.unsync(map2014);
			map2014.unsync(map1987);
			document.getElementById("etiq_sync").innerHTML = "Sincronizar";
		}
	}
	
	
	
	</script>
</body>
	
</html>